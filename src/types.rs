#![allow(dead_code)]

use lazy_static::lazy_static;
use std::fs::File;
use std::io;
use std::io::Read;
use std::sync::Mutex;

pub type Byte = u8;
pub type SignedByte = i8;
pub type Word = u16;
pub type SignedWord = i16;
pub type Cartridge = [Byte; FILESIZE];
pub type Ram = [Byte; MEM_SIZE];

/// RAM  Device Memory
pub const MEM_SIZE: usize = 0x10000;

//Likely at some point will switch the RAM and ROM to be part of the Emulator struct

/// ROM Device memory
const FILESIZE: usize = 0x20000;
lazy_static! {
    pub static ref CARTRIDGE_MEMORY: Mutex<Cartridge> = Mutex::new([0; FILESIZE]);
}

/// Loads the contents of the given file into the cartridge_memory array.
/// Returns the number of bytes read or an io::Error.
pub fn load_cartridge<P: AsRef<std::path::Path>>(path: P) -> io::Result<usize> {
    let mut file = File::open(path)?;
    let mut memory = CARTRIDGE_MEMORY.lock().unwrap();
    let bytes_read = file.read(&mut *memory)?;
    Ok(bytes_read)
}

#[derive(PartialEq)]
pub enum RomBankingType {
    MBC1,
    MBC2,
    None,
}

// I thought I was smart and would implement the rom banks as enums but little did I know...
#[repr(u8)]
#[derive(Clone, Copy, PartialEq)]
pub enum CurrentRomBank {
    Bank0,
    Bank1,
    Bank2,
    Bank3,
    Bank4,
    Bank5,
    Bank6,
    Bank7,
    Bank8,
    Bank9,
    Bank10,
    Bank11,
    Bank12,
    Bank13,
    Bank14,
    Bank15,
    Bank16,
    Bank17,
    Bank18,
    Bank19,
    Bank20,
    Bank21,
    Bank22,
    Bank23,
    Bank24,
    Bank25,
    Bank26,
    Bank27,
    Bank28,
    Bank29,
    Bank30,
    Bank31,
    Bank32,
    Bank33,
    Bank34,
    Bank35,
    Bank36,
    Bank37,
    Bank38,
    Bank39,
    Bank40,
    Bank41,
    Bank42,
    Bank43,
    Bank44,
    Bank45,
    Bank46,
    Bank47,
    Bank48,
    Bank49,
    Bank50,
    Bank51,
    Bank52,
    Bank53,
    Bank54,
    Bank55,
    Bank56,
    Bank57,
    Bank58,
    Bank59,
    Bank60,
    Bank61,
    Bank62,
    Bank63,
    Bank64,
    Bank65,
    Bank66,
    Bank67,
    Bank68,
    Bank69,
    Bank70,
    Bank71,
    Bank72,
    Bank73,
    Bank74,
    Bank75,
    Bank76,
    Bank77,
    Bank78,
    Bank79,
    Bank80,
    Bank81,
    Bank82,
    Bank83,
    Bank84,
    Bank85,
    Bank86,
    Bank87,
    Bank88,
    Bank89,
    Bank90,
    Bank91,
    Bank92,
    Bank93,
    Bank94,
    Bank95,
    Bank96,
    Bank97,
    Bank98,
    Bank99,
    Bank100,
    Bank101,
    Bank102,
    Bank103,
    Bank104,
    Bank105,
    Bank106,
    Bank107,
    Bank108,
    Bank109,
    Bank110,
    Bank111,
    Bank112,
    Bank113,
    Bank114,
    Bank115,
    Bank116,
    Bank117,
    Bank118,
    Bank119,
    Bank120,
    Bank121,
    Bank122,
    Bank123,
    Bank124,
    Bank125,
    Bank126,
    Bank127,
}

// All of this is no 1 priority for refactoring once things work
impl From<u8> for CurrentRomBank {
    fn from(val: u8) -> Self {
        use CurrentRomBank::*;
        match val {
            0 => Bank0,
            1 => Bank1,
            2 => Bank2,
            3 => Bank3,
            4 => Bank4,
            5 => Bank5,
            6 => Bank6,
            7 => Bank7,
            8 => Bank8,
            9 => Bank9,
            10 => Bank10,
            11 => Bank11,
            12 => Bank12,
            13 => Bank13,
            14 => Bank14,
            15 => Bank15,
            16 => Bank16,
            17 => Bank17,
            18 => Bank18,
            19 => Bank19,
            20 => Bank20,
            21 => Bank21,
            22 => Bank22,
            23 => Bank23,
            24 => Bank24,
            25 => Bank25,
            26 => Bank26,
            27 => Bank27,
            28 => Bank28,
            29 => Bank29,
            30 => Bank30,
            31 => Bank31,
            32 => Bank32,
            33 => Bank33,
            34 => Bank34,
            35 => Bank35,
            36 => Bank36,
            37 => Bank37,
            38 => Bank38,
            39 => Bank39,
            40 => Bank40,
            41 => Bank41,
            42 => Bank42,
            43 => Bank43,
            44 => Bank44,
            45 => Bank45,
            46 => Bank46,
            47 => Bank47,
            48 => Bank48,
            49 => Bank49,
            50 => Bank50,
            51 => Bank51,
            52 => Bank52,
            53 => Bank53,
            54 => Bank54,
            55 => Bank55,
            56 => Bank56,
            57 => Bank57,
            58 => Bank58,
            59 => Bank59,
            60 => Bank60,
            61 => Bank61,
            62 => Bank62,
            63 => Bank63,
            64 => Bank64,
            65 => Bank65,
            66 => Bank66,
            67 => Bank67,
            68 => Bank68,
            69 => Bank69,
            70 => Bank70,
            71 => Bank71,
            72 => Bank72,
            73 => Bank73,
            74 => Bank74,
            75 => Bank75,
            76 => Bank76,
            77 => Bank77,
            78 => Bank78,
            79 => Bank79,
            80 => Bank80,
            81 => Bank81,
            82 => Bank82,
            83 => Bank83,
            84 => Bank84,
            85 => Bank85,
            86 => Bank86,
            87 => Bank87,
            88 => Bank88,
            89 => Bank89,
            90 => Bank90,
            91 => Bank91,
            92 => Bank92,
            93 => Bank93,
            94 => Bank94,
            95 => Bank95,
            96 => Bank96,
            97 => Bank97,
            98 => Bank98,
            99 => Bank99,
            100 => Bank100,
            101 => Bank101,
            102 => Bank102,
            103 => Bank103,
            104 => Bank104,
            105 => Bank105,
            106 => Bank106,
            107 => Bank107,
            108 => Bank108,
            109 => Bank109,
            110 => Bank110,
            111 => Bank111,
            112 => Bank112,
            113 => Bank113,
            114 => Bank114,
            115 => Bank115,
            116 => Bank116,
            117 => Bank117,
            118 => Bank118,
            119 => Bank119,
            120 => Bank120,
            121 => Bank121,
            122 => Bank122,
            123 => Bank123,
            124 => Bank124,
            125 => Bank125,
            126 => Bank126,
            127 => Bank127,
            _ => Bank1, // Default or error handling
        }
    }
}

#[derive(Clone, Copy)]
pub enum CurrentRamBank {
    Bank0,
    Bank1,
    Bank2,
    Bank3,
}
